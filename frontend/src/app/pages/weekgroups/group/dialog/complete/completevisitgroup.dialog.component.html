<div class="mediumVerticalDialogContainer">
    <h3 mat-dialog-title>
        Completar Visita para: {{ incomingData?.prestador?.name || 'Prestador Desconocido' }}
    </h3>

    <ng-scrollbar visibility="hover">
        <mat-dialog-content class="mat-typography">

            <div role="alert" *ngIf="showAlert"
                class="alert alert-bg-danger d-flex justify-content-between align-items-center">
                <div class="gridi">
                    <span>Ten presente que al momento de <span style="font-weight: 700;">COMPLETAR</span> el Grupo de
                        Visitas, será
                        enviado automáticamente el Comunicado
                        e Visita al prestador, de acuerdo a la información que suministres.
                    </span>

                    <span class="mt-15">Ésta acción <span style="font-weight: 700;">NO SE PUEDE REVERSAR</span>.</span>
                    <span class="mt-15">Una vez completado el Grupo de Visita <span style="font-weight: 700;">SOLO PUEDE
                            SER EDITADO POR EL PROGRAMADOR</span>.</span>
                </div>

                <button (click)="dismissAlert()" type="button" data-dismiss="alert" aria-label="Close"
                    class="close bg-transparent text-white p-0 border-none"><i class="ri-close-line"></i>
                </button>
            </div>

            <mat-card class="trinta-card mb-25 bg-white border-none d-block">
                <mat-card-content>
                    <div class="mb-20">
                        <p class="mb-0 fz-14 regularText">
                            <span style="font-weight: 700; text-transform: uppercase;">Nombre:</span> {{
                            incomingData?.prestador?.name }}
                        </p>
                        <p class="mb-0 fz-14 regularText">
                            <span style="font-weight: 700; text-transform: uppercase;">Código:</span> {{
                            incomingData?.prestador?.code }}
                        </p>
                        <p class="mb-0 fz-14 regularText">
                            <span style="font-weight: 700; text-transform: uppercase;">Fecha Planificada:</span> {{
                            incomingData?.visit?.visitDate | date: 'dd/MM/yyyy' }}
                        </p>
                    </div>

                    <form class="mt-15" [formGroup]="completeVisitForm">
                        <div class="row">

                            <div class="col-sm-6">
                                <h6>Confirmar Fecha de visita Real</h6>
                                <mat-form-field appearance="fill">
                                    <i-feather name="calendar"></i-feather>
                                    <mat-label>MM/DD/AAAA</mat-label>
                                    <input matInput formControlName="visitDate" [matDatepicker]="visitDate"
                                        [matDatepickerFilter]="filterByWeekRange">
                                    <mat-datepicker-toggle matIconSuffix [for]="visitDate"></mat-datepicker-toggle>
                                    <mat-datepicker #visitDate></mat-datepicker>
                                    <mat-error
                                        *ngIf="completeVisitForm.get('visitDate')?.hasError('required') && completeVisitForm.get('visitDate')?.touched">
                                        Fecha real de visita es requerida
                                    </mat-error>
                                </mat-form-field>
                            </div>

                            <div class="col-sm-6">
                                <h6>Ingresar SADE</h6>
                                <mat-form-field>
                                    <i-feather name="edit-3"></i-feather>
                                    <input minlength="10" maxlength="10" matInput formControlName="sade" placeholder="Ingresa el número SADE">
                                    <mat-error
                                        *ngIf="completeVisitForm.get('sade')?.hasError('required') && completeVisitForm.get('sade')?.touched">
                                        SADE es requerido
                                    </mat-error>
                                    <mat-error
                                        *ngIf="completeVisitForm.get('sade')?.hasError('minlength') && completeVisitForm.get('sade')?.touched">
                                        SADE debe tener 10 dígitos
                                    </mat-error>
                                </mat-form-field>
                            </div>

                            <div class="col-sm-12">
                                <mat-form-field>
                                    <i-feather name="users"></i-feather>
                                    <mat-label>Miembros Asistentes</mat-label>
                                    <mat-select formControlName="members" multiple>
                                        <mat-option *ngFor="let user of incomingData?.weekgroup?.weekgroupusers"
                                            [value]="user.members.id">
                                            {{user.members?.name}} {{user.members?.surname}} {{user.members?.lastname}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-error
                                        *ngIf="completeVisitForm.get('members')?.hasError('required') && completeVisitForm.get('members')?.touched">
                                        Debes seleccionar al menos un miembro asistente.
                                    </mat-error>
                                </mat-form-field>
                            </div>

                            <div class="col-sm-12">
                                <select-custom [label]="'Servicios a verificar'" [icon]="'list'"
                                    [placeholder]="'Busca servicios por código o nombre...'"
                                    [options]="serviciosOptions" [incomingData]="incomingData.data?.servicios || []"
                                    formControlName="servicios" />
                                <mat-error class="customError"
                                    *ngIf="completeVisitForm.get('servicios')?.hasError('required') && completeVisitForm.get('servicios')?.touched">
                                    Debe seleccionar al menos un servicio
                                </mat-error>

                                <!-- Selected Servicios Chips -->
                                <div class="selected-chips-container mt-10"
                                    *ngIf="(serviciosSelect?.selectedOptions && serviciosSelect.selectedOptions.length > 0) || (selectedServicios && selectedServicios.length > 0)">
                                    <h6 class="mb-5 fz-14 regularText">Servicios seleccionados:</h6>
                                    <mat-chip-set>
                                        <!-- Use serviciosSelect if available, otherwise fall back to selectedServicios -->
                                        <ng-container
                                            *ngIf="serviciosSelect?.selectedOptions && serviciosSelect.selectedOptions.length > 0; else fallbackChips">
                                            <mat-chip *ngFor="let servicio of serviciosSelect?.selectedOptions"
                                                [removable]="true" (removed)="removeServicio(servicio.id)"
                                                class="servicio-chip">
                                                {{servicio.text}}
                                                <i-feather name="x" class="remove-icon" matChipRemove></i-feather>
                                            </mat-chip>
                                        </ng-container>

                                        <ng-template #fallbackChips>
                                            <mat-chip *ngFor="let servicio of selectedServicios || []"
                                                [removable]="true" (removed)="removeServicio(servicio.id)"
                                                class="servicio-chip">
                                                {{servicio.text || servicio.name}}
                                                <i-feather name="x" class="remove-icon" matChipRemove></i-feather>
                                            </mat-chip>
                                        </ng-template>
                                    </mat-chip-set>
                                </div>
                            </div>

                            <h6 style="margin-top: 30px; color: red">Actualizar información del Prestador</h6>
                            <span class="regularText">Es necesario actualizar los datos del Prestador antes de realizar
                                la visita. Para
                                esto, ingresa al <a style="font-weight: 600"
                                    href="https://prestadores.minsalud.gov.co/habilitacion/"> Sistema REPS</a> </span>

                            <div style="width: 100%; margin: 20px 0px;" class="row">

                                <div class="col-sm-6 col-md-6 col-lg-6">
                                    <input
                                        accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
                                        hidden #uploader (change)="onFilechangeService($event)"
                                        class="form-control" type="file" id="formFile" formControlName="serviciosFile">
                                    <button type="button" 
                                        [ngClass]="{'btn-success': serviciosFile}" 
                                        (click)="uploader.click()" 
                                        mat-fab extended 
                                        [color]="serviciosFile ? 'accent' : 'primary'">
                                        <mat-icon>{{ serviciosFile ? 'check_circle' : 'accessibility' }}</mat-icon>
                                        {{ serviciosFile ? 'Archivo Seleccionado' : 'Servicios e información del Prestador' }}
                                    </button>

                                    <div class="file-info" *ngIf="serviciosFile">
                                        <p class="file-name" style="margin-top: 5px;">
                                            <span class="filename-label">Archivo: </span>
                                            {{filename1}}
                                        </p>
                                        <p class="file-size" *ngIf="serviciosFile?.size">
                                            <span class="filesize-label">Tamaño: </span>
                                            {{(serviciosFile.size / 1024).toFixed(2)}} KB
                                        </p>
                                    </div>
                                    <p style="margin-top: 5px; color: #777;" *ngIf="!serviciosFile">Seleccione un archivo Excel</p>
                                </div>

                                <div class="col-sm-6 col-md-6 col-lg-6">
                                    <input
                                        accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
                                        hidden #uploader2 (change)="onFilechangeCapacity($event)"
                                        class="form-control" type="file" id="formFile2" formControlName="capacidadFile">
                                    <button type="button" 
                                        [ngClass]="{'btn-success': capacidadFile}" 
                                        (click)="uploader2.click()" 
                                        mat-fab extended 
                                        [color]="capacidadFile ? 'accent' : 'warn'">
                                        <mat-icon>{{ capacidadFile ? 'check_circle' : 'playlist_add_check' }}</mat-icon>
                                        {{ capacidadFile ? 'Archivo Seleccionado' : 'Capacidad Instalada del Prestador' }}
                                    </button>
                                    <div class="file-info" *ngIf="capacidadFile">
                                        <p class="file-name" style="margin-top: 5px;">
                                            <span class="filename-label">Archivo: </span>
                                            {{filename2}}
                                        </p>
                                        <p class="file-size" *ngIf="capacidadFile?.size">
                                            <span class="filesize-label">Tamaño: </span>
                                            {{(capacidadFile.size / 1024).toFixed(2)}} KB
                                        </p>
                                    </div>
                                    <p style="margin-top: 5px; color: #777;" *ngIf="!capacidadFile">Seleccione un archivo Excel</p>
                                </div>


                            </div>

                            <p>Completa cada uno de los Estandares</p>

                            <mat-accordion class="mb-25">
                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title>TALENTO HUMANO</mat-panel-title>
                                        <mat-panel-description>
                                            @if(completeVisitForm.get('th_verificadores')?.value &&
                                            completeVisitForm.get('th_todos')?.value &&
                                            completeVisitForm.get('th_propios')?.value) {
                                            <span class="trinta-badge  fw-medium d-inline-block">
                                                DILIGENCIADO
                                            </span>
                                            }
                                            @else {
                                            <span class="trinta-badge deactive fw-medium d-inline-block">
                                                PENDIENTE DILIGENCIAR
                                            </span>
                                            }
                                        </mat-panel-description>
                                    </mat-expansion-panel-header>

                                    <div class="col-sm-12">
                                        <mat-form-field>
                                            <i-feather name="users"></i-feather>
                                            <mat-label>Verifcadores para este Estandar</mat-label>
                                            <mat-select formControlName="th_verificadores" multiple>
                                                <mat-option *ngFor="let user of incomingData?.weekgroup?.weekgroupusers"
                                                    [value]="user.members.id">
                                                    {{user.members?.name}} {{user.members?.surname}}
                                                    {{user.members?.lastname}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Todos los Servicios</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="th_todos"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Propios del servicio</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="th_propios"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>
                                </mat-expansion-panel>

                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title> INFRAESTRUCTURA </mat-panel-title>
                                        <mat-panel-description>
                                            @if(completeVisitForm.get('infra_verificadores')?.value &&
                                            completeVisitForm.get('infra_todos')?.value &&
                                            completeVisitForm.get('infra_propios')?.value) {
                                            <span class="trinta-badge  fw-medium d-inline-block">
                                                DILIGENCIADO
                                            </span>
                                            }
                                            @else {
                                            <span class="trinta-badge deactive fw-medium d-inline-block">
                                                PENDIENTE DILIGENCIAR
                                            </span>
                                            }
                                        </mat-panel-description>
                                    </mat-expansion-panel-header>

                                    <div class="col-sm-12">

                                        <mat-form-field>
                                            <i-feather name="users"></i-feather>
                                            <mat-label>Verifcadores para este Estandar</mat-label>
                                            <mat-select formControlName="infra_verificadores" multiple>
                                                <mat-option *ngFor="let user of incomingData?.weekgroup?.weekgroupusers"
                                                    [value]="user.members.id">
                                                    {{user.members?.name}} {{user.members?.surname}}
                                                    {{user.members?.lastname}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>

                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Todos los Servicios</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="infra_todos"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Propios del servicio</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="infra_propios"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>

                                </mat-expansion-panel>

                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title> DOTACIÓN</mat-panel-title>
                                        <mat-panel-description>
                                            @if(completeVisitForm.get('dotacion_verificadores')?.value &&
                                            completeVisitForm.get('dotacion_todos')?.value &&
                                            completeVisitForm.get('dotacion_propios')?.value) {
                                            <span class="trinta-badge  fw-medium d-inline-block">
                                                DILIGENCIADO
                                            </span>
                                            }
                                            @else {
                                            <span class="trinta-badge deactive fw-medium d-inline-block">
                                                PENDIENTE DILIGENCIAR
                                            </span>
                                            }
                                        </mat-panel-description>
                                    </mat-expansion-panel-header>

                                    <div class="col-sm-12">
                                        <mat-form-field>
                                            <i-feather name="users"></i-feather>
                                            <mat-label>Verifcadores para este Estandar</mat-label>
                                            <mat-select formControlName="dotacion_verificadores" multiple>
                                                <mat-option *ngFor="let user of incomingData?.weekgroup?.weekgroupusers"
                                                    [value]="user.members.id">
                                                    {{user.members?.name}} {{user.members?.surname}}
                                                    {{user.members?.lastname}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Todos los Servicios</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="dotacion_todos"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Propios del servicio</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="dotacion_propios"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>

                                </mat-expansion-panel>

                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title> MEDICAMENTOS, DISPOSITIVOS MÉDICOS E INSUMOS
                                        </mat-panel-title>
                                        <mat-panel-description>
                                            @if(completeVisitForm.get('mdi_verificadores')?.value &&
                                            completeVisitForm.get('mdi_todos')?.value &&
                                            completeVisitForm.get('mdi_propios')?.value) {
                                            <span class="trinta-badge  fw-medium d-inline-block">
                                                DILIGENCIADO
                                            </span>
                                            }
                                            @else {
                                            <span class="trinta-badge deactive fw-medium d-inline-block">
                                                PENDIENTE DILIGENCIAR
                                            </span>
                                            }

                                        </mat-panel-description>
                                    </mat-expansion-panel-header>

                                    <div class="col-sm-12">
                                        <mat-form-field>
                                            <i-feather name="users"></i-feather>
                                            <mat-label>Verifcadores para este Estandar</mat-label>
                                            <mat-select formControlName="mdi_verificadores" multiple>
                                                <mat-option *ngFor="let user of incomingData?.weekgroup?.weekgroupusers"
                                                    [value]="user.members.id">
                                                    {{user.members?.name}} {{user.members?.surname}}
                                                    {{user.members?.lastname}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Todos los Servicios</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="mdi_todos"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Propios del servicio</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="mdi_propios"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>

                                </mat-expansion-panel>

                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title> PROCESOS PRIORITARIOS </mat-panel-title>
                                        <mat-panel-description>
                                            @if(completeVisitForm.get('procedimientos_verificadores')?.value &&
                                            completeVisitForm.get('procedimientos_todos')?.value &&
                                            completeVisitForm.get('procedimientos_propios')?.value) {
                                            <span class="trinta-badge  fw-medium d-inline-block">
                                                DILIGENCIADO
                                            </span>
                                            }
                                            @else {
                                            <span class="trinta-badge deactive fw-medium d-inline-block">
                                                PENDIENTE DILIGENCIAR
                                            </span>
                                            }
                                        </mat-panel-description>
                                    </mat-expansion-panel-header>

                                    <div class="col-sm-12">
                                        <mat-form-field>
                                            <i-feather name="users"></i-feather>
                                            <mat-label>Verifcadores para este Estandar</mat-label>
                                            <mat-select formControlName="procedimientos_verificadores" multiple>
                                                <mat-option *ngFor="let user of incomingData?.weekgroup?.weekgroupusers"
                                                    [value]="user.members.id">
                                                    {{user.members?.name}} {{user.members?.surname}}
                                                    {{user.members?.lastname}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Todos los Servicios</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="procedimientos_todos"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Propios del servicio</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="procedimientos_propios"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>
                                </mat-expansion-panel>

                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title>HISTORIA CLÍNICA Y REGISTROS </mat-panel-title>
                                        <mat-panel-description>
                                            @if(completeVisitForm.get('hcr_verificadores')?.value &&
                                            completeVisitForm.get('hcr_todos')?.value &&
                                            completeVisitForm.get('hcr_propios')?.value) {
                                            <span class="trinta-badge  fw-medium d-inline-block">
                                                DILIGENCIADO
                                            </span>
                                            }
                                            @else {
                                            <span class="trinta-badge deactive fw-medium d-inline-block">
                                                PENDIENTE DILIGENCIAR
                                            </span>
                                            }
                                        </mat-panel-description>
                                    </mat-expansion-panel-header>

                                    <div class="col-sm-12">
                                        <mat-form-field>
                                            <i-feather name="users"></i-feather>
                                            <mat-label>Verifcadores para este Estandar</mat-label>
                                            <mat-select formControlName="hcr_verificadores" multiple>
                                                <mat-option *ngFor="let user of incomingData?.weekgroup?.weekgroupusers"
                                                    [value]="user.members.id">
                                                    {{user.members?.name}} {{user.members?.surname}}
                                                    {{user.members?.lastname}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Todos los Servicios</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="hcr_todos"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Propios del servicio</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="hcr_propios"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>
                                </mat-expansion-panel>

                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title>INTERDEPENDENCIA </mat-panel-title>
                                        <mat-panel-description> 
                                            @if(completeVisitForm.get('interdependencias_verificadores')?.value && completeVisitForm.get('interdependencias_todos')?.value && completeVisitForm.get('interdependencias_propios')?.value) {
                                                <span class="trinta-badge  fw-medium d-inline-block">
                                                    DILIGENCIADO
                                                </span>
                                            }
                                            @else {
                                                <span class="trinta-badge deactive fw-medium d-inline-block">
                                                    PENDIENTE DILIGENCIAR
                                                </span>
                                            }   
                                            
                                            
                                        </mat-panel-description>
                                    </mat-expansion-panel-header>

                                    <div class="col-sm-12">
                                        <mat-form-field>
                                            <i-feather name="users"></i-feather>
                                            <mat-label>Verifcadores para este Estandar</mat-label>
                                            <mat-select formControlName="interdependencias_verificadores" multiple>
                                                <mat-option *ngFor="let user of incomingData?.weekgroup?.weekgroupusers"
                                                    [value]="user.members.id">
                                                    {{user.members?.name}} {{user.members?.surname}}
                                                    {{user.members?.lastname}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Todos los Servicios</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="interdependencias_todos"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-12">
                                        <mat-form-field class="textarea">
                                            <i-feather name="file-text"></i-feather>
                                            <mat-label>Propios del servicio</mat-label>
                                            <textarea matAutosizeMaxRows="2" [rows]="2" matInput
                                                formControlName="interdependencias_propios"
                                                placeholder="Agrega observaciones."></textarea>
                                        </mat-form-field>
                                    </div>
                                </mat-expansion-panel>
                            </mat-accordion>


                            <!--  <h5>Agregar: Recorrido {{recorridos.length+1}}</h5> -->

                           <div class="row">
                                <div class="col-sm-12">
                                    <h5 style="margin-top: 30px; margin-bottom: 20px; color: #3f51b5;">Agregar Recorridos</h5>
                                </div>
                                
                                <div class="col-sm-12">
                                    <mat-form-field>
                                        <i-feather name="edit-3"></i-feather>
                                        <mat-label>Nombre del Recorrido</mat-label>
                                        <input matInput formControlName="recorridoName" placeholder="Ingrese el nombre del recorrido" minlength="5">
                                        <mat-error *ngIf="completeVisitForm.get('recorridoName')?.hasError('minlength')">
                                            El nombre debe tener al menos 5 caracteres
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <div class="col-sm-6">
                                    <mat-form-field>
                                        <i-feather name="users"></i-feather>
                                        <mat-label>Verificadores para el Recorrido</mat-label>
                                        <mat-select formControlName="recorridoVerificadores" multiple>
                                            <mat-option *ngFor="let user of incomingData?.weekgroup?.weekgroupusers"
                                                [value]="user.members.id">
                                                {{user.members?.name}} {{user.members?.surname}} {{user.members?.lastname}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>

                                <div class="col-sm-6">
                                    <select-custom [label]="'Servicios para el Recorrido'" [icon]="'list'"
                                        [placeholder]="'Busca servicios por código o nombre...'"
                                        [options]="serviciosOptions" [incomingData]="[]"
                                        formControlName="recorridoServicios" />
                                </div>

                                <div class="col-sm-12" style="margin-top: 15px;">
                                    <button 
                                        type="button" 
                                        mat-raised-button 
                                        color="primary"
                                        [disabled]="!canAddRecorrido()"
                                        (click)="addRecorrido()">
                                        <mat-icon>add</mat-icon>
                                        Agregar Recorrido
                                    </button>
                                </div>

                                <!-- Recorridos List -->
                                <div class="col-sm-12" *ngIf="recorridos.length > 0" style="margin-top: 30px;">
                                    <h6 style="margin-bottom: 15px; color: #3f51b5;">Recorridos Agregados ({{recorridos.length}})</h6>
                                    
                                    <table mat-table [dataSource]="recorridosDataSource" class="w-100">
                                        <!-- Name Column -->
                                        <ng-container matColumnDef="name">
                                            <th mat-header-cell *matHeaderCellDef>
                                                <strong>Nombre</strong>
                                            </th>
                                            <td mat-cell *matCellDef="let recorrido">
                                                <div class="d-flex align-items-center">
                                                    <mat-icon class="me-2 text-primary">assignment</mat-icon>
                                                    <span class="fw-medium">{{recorrido.name}}</span>
                                                </div>
                                            </td>
                                        </ng-container>

                                        <!-- Verificadores Column -->
                                        <ng-container matColumnDef="verificadores">
                                            <th mat-header-cell *matHeaderCellDef>
                                                <strong>Verificadores</strong>
                                            </th>
                                            <td mat-cell *matCellDef="let recorrido">
                                                <mat-chip-set>
                                                    <mat-chip 
                                                        *ngFor="let verificadorId of recorrido.verificadores"
                                                        class="me-1 mb-1">
                                                        <mat-icon matChipAvatar>person</mat-icon>
                                                        {{getUserName(verificadorId)}}
                                                    </mat-chip>
                                                </mat-chip-set>
                                            </td>
                                        </ng-container>

                                        <!-- Servicios Column -->
                                        <ng-container matColumnDef="servicios">
                                            <th mat-header-cell *matHeaderCellDef>
                                                <strong>Servicios</strong>
                                            </th>
                                            <td mat-cell *matCellDef="let recorrido">
                                                <div class="d-flex align-items-center">
                                                    <mat-icon class="me-2 text-accent">medical_services</mat-icon>
                                                    <span class="trinta-badge fw-medium">
                                                        {{recorrido.servicios.length}} servicio(s)
                                                    </span>
                                                </div>
                                            </td>
                                        </ng-container>

                                        <!-- Actions Column -->
                                        <ng-container matColumnDef="actions">
                                            <th mat-header-cell *matHeaderCellDef>
                                                <strong>Acciones</strong>
                                            </th>
                                            <td mat-cell *matCellDef="let recorrido; let i = index">
                                                <button 
                                                    mat-icon-button 
                                                    color="warn" 
                                                    (click)="removeRecorrido(i)"
                                                    matTooltip="Eliminar recorrido">
                                                    <mat-icon>delete_outline</mat-icon>
                                                </button>
                                            </td>
                                        </ng-container>

                                        <tr mat-header-row *matHeaderRowDef="recorridosDisplayColumns"></tr>
                                        <tr mat-row *matRowDef="let row; columns: recorridosDisplayColumns;"></tr>
                                    </table>
                                </div>
                            </div>

 
                         

                        </div>
                    </form>
                </mat-card-content>
            </mat-card>
        </mat-dialog-content>
    </ng-scrollbar>
    <mat-dialog-actions align="end">
        <button mat-button color="warn" mat-dialog-close>
            Cancelar
        </button>
        <button mat-button [disabled]="completeVisitForm.invalid" (click)="onSubmit()" cdkFocusInitial>
            Completar Grupo de Visita
        </button>
    </mat-dialog-actions>
</div>
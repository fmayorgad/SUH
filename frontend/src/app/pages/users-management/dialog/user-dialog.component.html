<div class="mediumVerticalDialogContainer">
    <h3 mat-dialog-title class="dialog-title">{{ dialogTitle }}</h3>

    <mat-dialog-content class="mat-typography">
        <mat-card class="trinta-card mb-25 bg-white border-none d-block">
            <mat-card-content>
                <form [formGroup]="userForm">
                    <div class="row">
                        <!-- Personal Information -->
                        <div class="col-sm-12">
                            <h6>Información Personal</h6>
                        </div>

                        <div class="col-sm-12">
                            <mat-form-field appearance="fill">
                                <i-feather name="user"></i-feather>
                                <mat-label>Nombre</mat-label>
                                <input matInput formControlName="name" placeholder="Nombre">
                                <mat-error *ngIf="userForm.get('name')?.hasError('required') && userForm.get('name')?.touched">
                                    Nombre es requerido
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div class="col-sm-6">
                            <mat-form-field appearance="fill">
                                <i-feather name="user"></i-feather>
                                <mat-label>Apellido</mat-label>
                                <input matInput formControlName="surname" placeholder="Apellido">
                                <mat-error *ngIf="userForm.get('surname')?.hasError('required') && userForm.get('surname')?.touched">
                                    Apellido es requerido
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div class="col-sm-6">
                            <mat-form-field appearance="fill">
                                <i-feather name="user"></i-feather>
                                <mat-label>Segundo Apellido</mat-label>
                                <input matInput formControlName="lastname" placeholder="Segundo Apellido">
                            </mat-form-field>
                        </div>

                        <div class="col-sm-6">
                            <mat-form-field appearance="fill">
                                <i-feather name="calendar"></i-feather>
                                <mat-label>Fecha de Nacimiento</mat-label>
                                <input matInput formControlName="birthday" [matDatepicker]="birthdayPicker">
                                <mat-datepicker-toggle matIconSuffix [for]="birthdayPicker" [disabled]="readOnly"></mat-datepicker-toggle>
                                <mat-datepicker #birthdayPicker></mat-datepicker>
                            </mat-form-field>
                        </div>

                        <div class="col-sm-6">
                            <mat-form-field appearance="fill">
                                <i-feather name="users"></i-feather>
                                <mat-label>Género</mat-label>
                                <mat-select formControlName="gender">
                                    <mat-option value="MASCULINO">Masculino</mat-option>
                                    <mat-option value="FEMENINO">Femenino</mat-option>
                                    <mat-option value="OTRO">Otro</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <!-- Identification Information -->
                        <div class="col-sm-12">
                            <h6>Información de Identificación</h6>
                        </div>

                        <div class="col-sm-4">
                            <mat-form-field appearance="fill">
                                <span class="material-symbols-outlined">
                                    badge
                                </span>
                                <mat-label>Tipo de Identificación</mat-label>
                                <mat-select formControlName="identification_type">
                                    <mat-option value="CEDULA">Cédula de Ciudadanía</mat-option>
                                    <mat-option value="EXTRANGERIA">Cédula de Extranjería</mat-option>
                                    <mat-option value="PASAPORTE">Pasaporte</mat-option>
                                </mat-select>
                                <mat-error *ngIf="userForm.get('identification_type')?.hasError('required') && userForm.get('identification_type')?.touched">
                                    Tipo de identificación es requerido
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div class="col-sm-8">
                            <mat-form-field appearance="fill">
                                <span class="material-symbols-outlined">
                                    tag
                                </span>
                                <mat-label>Número de Identificación</mat-label>
                                <input matInput formControlName="identification_number" placeholder="Número de Identificación">
                                <mat-error *ngIf="userForm.get('identification_number')?.hasError('required') && userForm.get('identification_number')?.touched">
                                    Número de identificación es requerido
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <!-- Contact Information -->
                        <div class="col-sm-12">
                            <h6>Información de Contacto</h6>
                        </div>

                        <div class="col-sm-6">
                            <mat-form-field appearance="fill">
                                <i-feather name="phone"></i-feather>
                                <mat-label>Teléfono</mat-label>
                                <input matInput formControlName="phone" placeholder="Teléfono">
                            </mat-form-field>
                        </div>

                        <div class="col-sm-6">
                            <mat-form-field appearance="fill">
                                <i-feather name="mail"></i-feather>
                                <mat-label>Email</mat-label>
                                <input matInput formControlName="email" placeholder="Email">
                                <mat-error *ngIf="userForm.get('email')?.hasError('required') && userForm.get('email')?.touched">
                                    Email es requerido
                                </mat-error>
                                <mat-error *ngIf="userForm.get('email')?.hasError('email') && userForm.get('email')?.touched">
                                    Email inválido
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <!-- Account Information -->
                        <div class="col-sm-12">
                            <h6>Información de Cuenta</h6>
                        </div>

                        <div class="col-sm-6">
                            <mat-form-field appearance="fill">
                                <i-feather name="user"></i-feather>
                                <mat-label>Nombre de Usuario</mat-label>
                                <input matInput formControlName="username" placeholder="Nombre de Usuario">
                                <mat-error *ngIf="userForm.get('username')?.hasError('required') && userForm.get('username')?.touched">
                                    Nombre de usuario es requerido
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div class="col-sm-6" *ngIf="!readOnly">
                            <mat-form-field appearance="fill">
                                <i-feather name="lock"></i-feather>
                                <mat-label>Contraseña</mat-label>
                                <input matInput type="password" formControlName="password" placeholder="Contraseña">
                                <mat-error *ngIf="userForm.get('password')?.hasError('required') && userForm.get('password')?.touched">
                                    Contraseña es requerida
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div class="col-sm-6">
                            <mat-form-field appearance="fill">
                                <i-feather name="tag"></i-feather>
                                <mat-label>Código de Planta</mat-label>
                                <input matInput formControlName="planta_code" placeholder="Código de Planta">
                            </mat-form-field>
                        </div>

                        <div class="col-sm-6">
                            <mat-form-field appearance="fill">
                                <i-feather name="user"></i-feather>
                                <mat-label>Perfil</mat-label>
                                <mat-select formControlName="profile">
                                    <mat-option *ngFor="let profile of profiles" [value]="profile.id">
                                        {{profile.text}}
                                    </mat-option>
                                </mat-select>
                                <mat-error *ngIf="userForm.get('profile')?.hasError('required') && userForm.get('profile')?.touched">
                                    Perfil es requerido
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div class="col-sm-6">
                            <mat-form-field appearance="fill">
                                <i-feather name="briefcase"></i-feather>
                                <mat-label>Tipo de Contrato</mat-label>
                                <mat-select formControlName="status">
                                    <mat-option value="CONTRATISTA">Contratista</mat-option>
                                    <mat-option value="PROFESIONAL_ESPECIALIZADO">Profesional Especializado</mat-option>
                                    <mat-option value="PROFESIONAL_UNIVERSITARIO">Profesional Universitario</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <!-- Signature Section -->
                        <div class="col-sm-12" *ngIf="!readOnly">
                            <h6>Firma Digital</h6>
                        </div>

                        <div class="col-sm-12" *ngIf="!readOnly">
                            <div class="signature-upload-section">
                                <input 
                                    type="file" 
                                    id="signature-upload" 
                                    accept="image/*" 
                                    (change)="onSignatureFileSelected($event)"
                                    style="display: none;">
                                
                                <button 
                                    type="button" 
                                    mat-raised-button 
                                    color="primary" 
                                    (click)="triggerFileInput()"
                                    [disabled]="readOnly">
                                    <mat-icon>upload</mat-icon>
                                    Subir Firma
                                </button>
                                
                                <div class="signature-preview mt-3" *ngIf="signaturePreviewUrl">
                                    <h6>Vista Previa de la Firma:</h6>
                                    <div class="signature-image-container">
                                        <img 
                                            [src]="signaturePreviewUrl" 
                                            alt="Firma del usuario"
                                            class="signature-preview-image">
                                        <button 
                                            type="button" 
                                            mat-icon-button 
                                            color="warn" 
                                            (click)="removeSignature()"
                                            class="remove-signature-btn">
                                            <mat-icon>close</mat-icon>
                                        </button>
                                    </div>
                                </div>
                                
                                <mat-error *ngIf="userForm.get('signature')?.hasError('required') && userForm.get('signature')?.touched">
                                    La firma es requerida
                                </mat-error>
                            </div>
                        </div>

                        <div class="col-sm-12">
                            <h6>Estado</h6>
                            <mat-radio-group formControlName="state" class="state-radio-group">
                                <mat-radio-button value="ACTIVO">Activo</mat-radio-button>
                                <mat-radio-button value="INACTIVO">Inactivo</mat-radio-button>
                            </mat-radio-group>
                        </div>
                    </div>
                </form>
            </mat-card-content>
        </mat-card>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
        <button mat-button color="warn" [disabled]="submitting" (click)="onCancel()">
            {{ readOnly ? 'Cerrar' : 'Cancelar' }}
        </button>
        <button *ngIf="!readOnly" mat-button color="primary" [disabled]="userForm.invalid || submitting" (click)="onSubmit()" cdkFocusInitial>
            <span *ngIf="!submitting">{{ isEdit ? 'Actualizar' : 'Crear' }}</span>
            <span *ngIf="submitting">Procesando...</span>
        </button>
    </mat-dialog-actions>
</div> 
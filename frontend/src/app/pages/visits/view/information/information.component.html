<!-- Información Fiscal y Servicios -->
<mat-card class="trinta-card mb-25 bg-white border-none d-block">
    <mat-card-header>
        <mat-card-title>
            <h4 class="mt-0 mb-0">
                Información actual y Servicios
            </h4>
        </mat-card-title>
    </mat-card-header>
    <mat-card-content>
        <mat-tab-group animationDuration="300ms" mat-stretch-tabs="false" mat-align-tabs="start">
            <mat-tab label="Información del Prestador">
                <div class="p-15">
                    <div class="alert alert-bg-warning d-flex align-items-center p-15" role="alert"
                        *ngIf="!visitData?.prestador?.fiscalYearInformation || visitData?.prestador?.fiscalYearInformation.length === 0">
                        <mat-icon class="mr-2">warning</mat-icon>
                        No hay información fiscal disponible para este prestador en el año actual.
                    </div>

                    <div
                        *ngIf="visitData?.prestador?.fiscalYearInformation && visitData?.prestador?.fiscalYearInformation.length > 0">
                        
                        <!-- Fiscal year selector if multiple years are available -->
                        <mat-card *ngIf="visitData?.prestador?.fiscalYearInformation.length > 1" appearance="outlined" class="mb-4">
                            <mat-card-content>
                                <h5 class="mb-3">Seleccione año fiscal:</h5>
                                <mat-button-toggle-group [(value)]="selectedFiscalYearIndex" appearance="standard" class="w-100">
                                    <mat-button-toggle *ngFor="let info of visitData?.prestador?.fiscalYearInformation; let i = index"
                                        [value]="i">
                                        Año {{info.numero_sede || i + 1}} - {{info.nombreSede || 'Sin nombre'}}
                                    </mat-button-toggle>
                                </mat-button-toggle-group>
                            </mat-card-content>
                        </mat-card>

                        <!-- Display the selected fiscal year info -->
                        <div *ngIf="visitData?.prestador?.fiscalYearInformation[selectedFiscalYearIndex || 0] as fiscalInfo">
                            <div class="row">
                                <div class="col-md-6">
                                    <mat-card appearance="outlined" class="h-100">
                                       
                                        <mat-card-content class="mt-3">
                                            <mat-list>
                                                <mat-list-item>
                                                    <span matListItemTitle>Nombre</span>
                                                    <span matListItemLine>{{fiscalInfo.nombreSede || 'No disponible'}}</span>
                                                </mat-list-item>
                                                <mat-divider></mat-divider>
                                                <mat-list-item>
                                                    <span matListItemTitle>Código Sede</span>
                                                    <span matListItemLine>{{fiscalInfo.codigoSede || 'No disponible'}}</span>
                                                </mat-list-item>
                                                <mat-divider></mat-divider>
                                                <mat-list-item>
                                                    <span matListItemTitle>Código Habilitación</span>
                                                    <span matListItemLine>{{fiscalInfo.codigo_habilitacion || fiscalInfo.habi_codigo_habilitacion || 'No disponible'}}</span>
                                                </mat-list-item>
                                                <mat-divider></mat-divider>
                                                <mat-list-item>
                                                    <span matListItemTitle>Número Sede</span>
                                                    <span matListItemLine>{{fiscalInfo.numero_sede || 'No disponible'}}</span>
                                                </mat-list-item>
                                                <mat-divider></mat-divider>
                                                <mat-list-item>
                                                    <span matListItemTitle>NIT</span>
                                                    <span matListItemLine>{{fiscalInfo.nits_nit || 'No disponible'}}{{fiscalInfo.dv ? '-' + fiscalInfo.dv : ''}}</span>
                                                </mat-list-item>
                                            </mat-list>
                                        </mat-card-content>
                                    </mat-card>
                                </div>
                                <div class="col-md-6">
                                    <mat-card appearance="outlined" class="h-100">
                                      
                                        <mat-card-content class="mt-3">
                                            <mat-list>
                                                <mat-list-item>
                                                    <mat-icon matListItemIcon>location_on</mat-icon>
                                                    <span matListItemTitle>Dirección</span>
                                                    <span matListItemLine>{{fiscalInfo.direccionSede || 'No disponible'}}</span>
                                                </mat-list-item>
                                                <mat-divider></mat-divider>
                                                <mat-list-item>
                                                    <mat-icon matListItemIcon>phone</mat-icon>
                                                    <span matListItemTitle>Teléfono</span>
                                                    <span matListItemLine>{{fiscalInfo.telefonoSede || fiscalInfo.telefonoPrestador || 'No disponible'}}</span>
                                                </mat-list-item>
                                                <mat-divider></mat-divider>
                                                <mat-list-item>
                                                    <mat-icon matListItemIcon>email</mat-icon>
                                                    <span matListItemTitle>Correo</span>
                                                    <span matListItemLine>{{fiscalInfo.correoSede || fiscalInfo.correoPrestador || 'No disponible'}}</span>
                                                </mat-list-item>
                                                <mat-divider></mat-divider>
                                                <mat-list-item>
                                                    <mat-icon matListItemIcon>person</mat-icon>
                                                    <span matListItemTitle>Representante Legal</span>
                                                    <span matListItemLine>{{fiscalInfo.representante_legal || 'No disponible'}}</span>
                                                </mat-list-item>
                                                <mat-divider></mat-divider>
                                                <mat-list-item>
                                                    <mat-icon matListItemIcon>contact_mail</mat-icon>
                                                    <span matListItemTitle>Correo Representante</span>
                                                    <span matListItemLine>{{fiscalInfo.correoRepresentante || 'No disponible'}}</span>
                                                </mat-list-item>
                                            </mat-list>
                                        </mat-card-content>
                                    </mat-card>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>
            <mat-tab label="Servicios cargados desde Archivo REPS">
                <div class="services-container filterHeaderContainer ">
                    <div class="alert alert-bg-warning d-flex align-items-center" role="alert"
                        *ngIf="!visitData?.prestador?.fiscalYearServicios || visitData?.prestador?.fiscalYearServicios.length === 0">
                        <i class="material-icons align-middle mr-2">warning</i>
                        No hay servicios fiscales disponibles para este prestador.
                    </div>

                    <div
                        *ngIf="visitData?.prestador?.fiscalYearServicios && visitData?.prestador?.fiscalYearServicios.length > 0">
                        <div class="col-md-12">
                            <!-- Services filter -->
                            <div class="filter-container p-0 d-flex align-items-center justify-content-between">
                                <mat-form-field appearance="outline" class="flex-grow-1 me-3">
                                    <mat-label>Buscar servicios</mat-label>
                                    <input matInput (keyup)="applyServiceFilter($event)"
                                        placeholder="Buscar por nombre o código...">
                                    <mat-icon matSuffix>search</mat-icon>
                                </mat-form-field>

                                <div class="complexity-filter">

                                    <!-- Simple button filters -->
                                    <div class="filter-buttons">
                                        <button mat-button [class.selected]="complejidadFilter === null"
                                            (click)="filterByComplejidad(null)">
                                            Todos
                                        </button>
                                        <button mat-button class="baja-chip"
                                            [class.selected]="complejidadFilter === 'BAJA'"
                                            (click)="filterByComplejidad('BAJA')">
                                            Baja
                                        </button>
                                        <button mat-button class="media-chip"
                                            [class.selected]="complejidadFilter === 'MEDIA'"
                                            (click)="filterByComplejidad('MEDIA')">
                                            Media
                                        </button>
                                        <button mat-button class="alta-chip"
                                            [class.selected]="complejidadFilter === 'ALTA'"
                                            (click)="filterByComplejidad('ALTA')">
                                            Alta
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Services table -->
                            <div class="services-table">
                                <table mat-table [dataSource]="serviciosDataSource" class="w-100">

                                    <!-- Código Column -->
                                    <ng-container matColumnDef="codigo">
                                        <th mat-header-cell *matHeaderCellDef>Código</th>
                                        <td mat-cell *matCellDef="let servicio">
                                            <span class="service-code">{{servicio.servicio?.code ||
                                                'N/A'}}</span>
                                        </td>
                                    </ng-container>

                                    <!-- Nombre Column -->
                                    <ng-container matColumnDef="nombre">
                                        <th mat-header-cell *matHeaderCellDef>Nombre del Servicio</th>
                                        <td mat-cell *matCellDef="let servicio">
                                            <div class="service-name">
                                                <span class="fw-medium">{{servicio.servicio?.name || 'No
                                                    disponible'}}</span>
                                                <small class="text-muted d-block" *ngIf="servicio.fecha_apertura">
                                                    Apertura: {{formatFechaReps(servicio.fecha_apertura)}}
                                                </small>
                                            </div>
                                        </td>
                                    </ng-container>

                                    <!-- Complejidad Column -->
                                    <ng-container matColumnDef="complejidad">
                                        <th mat-header-cell *matHeaderCellDef>Complejidad</th>
                                        <td mat-cell *matCellDef="let servicio">
                                            <span class="complejidad-badge" [ngClass]="{
                                                'baja': servicio.complejidades === 'BAJA',
                                                'media': servicio.complejidades === 'MEDIA',
                                                'alta': servicio.complejidades === 'ALTA'
                                            }">
                                                {{servicio.complejidades || 'No definida'}}
                                            </span>
                                        </td>
                                    </ng-container>

                                    <!-- Modalidades Column -->
                                    <ng-container matColumnDef="modalidades">
                                        <th mat-header-cell *matHeaderCellDef>Modalidades</th>
                                        <td mat-cell *matCellDef="let servicio">
                                            <div class="modalidades-container">
                                                <span class="modalidad-chip"
                                                    [ngClass]="{'active': servicio.modalidad_intramural}"
                                                    matTooltip="Intramural">
                                                    <mat-icon>domain</mat-icon>
                                                </span>
                                                <span class="modalidad-chip"
                                                    [ngClass]="{'active': servicio.modalidad_extramural}"
                                                    matTooltip="Extramural">
                                                    <mat-icon>nature_people</mat-icon>
                                                </span>
                                                <span class="modalidad-chip"
                                                    [ngClass]="{'active': servicio.modalidad_domiciliario}"
                                                    matTooltip="Domiciliario">
                                                    <mat-icon>house</mat-icon>
                                                </span>
                                                <span class="modalidad-chip"
                                                    [ngClass]="{'active': servicio.modalidad_telemedicina}"
                                                    matTooltip="Telemedicina">
                                                    <mat-icon>computer</mat-icon>
                                                </span>
                                                <span class="modalidad-chip"
                                                    [ngClass]="{'active': servicio.modalidad_unidad_movil}"
                                                    matTooltip="Unidad Móvil">
                                                    <mat-icon>local_shipping</mat-icon>
                                                </span>
                                            </div>
                                        </td>
                                    </ng-container>

                                    <!-- Estado Column -->
                                    <ng-container matColumnDef="estado">
                                        <th mat-header-cell *matHeaderCellDef>Estado</th>
                                        <td mat-cell *matCellDef="let servicio">
                                            <span class="service-badge" [ngClass]="{
                                                'active': servicio.state === 'ACTIVO',
                                                'inactive': servicio.state === 'INACTIVO',
                                                'pending': servicio.state === 'PENDIENTE'
                                            }">
                                                {{servicio.state || 'No definido'}}
                                            </span>
                                        </td>
                                    </ng-container>

                                    <!-- Horario Column -->
                                    <ng-container matColumnDef="horario">
                                        <th mat-header-cell *matHeaderCellDef>Horario</th>
                                        <td mat-cell *matCellDef="let servicio">
                                            <button mat-icon-button color="primary" [matMenuTriggerFor]="horarioMenu"
                                                aria-label="Ver horario">
                                                <mat-icon>schedule</mat-icon>
                                            </button>

                                            <mat-menu #horarioMenu="matMenu" class="horario-menu">
                                                <div class="px-3 py-2" (click)="$event.stopPropagation()">
                                                    <div class="horario-row"
                                                        [ngClass]="{'active': !!servicio.horario_lunes}">
                                                        <span class="day">Lunes</span>
                                                        <span
                                                            class="time">{{formatHorario(servicio.horario_lunes)}}</span>
                                                    </div>
                                                    <div class="horario-row"
                                                        [ngClass]="{'active': !!servicio.horario_martes}">
                                                        <span class="day">Martes</span>
                                                        <span
                                                            class="time">{{formatHorario(servicio.horario_martes)}}</span>
                                                    </div>
                                                    <div class="horario-row"
                                                        [ngClass]="{'active': !!servicio.horario_miercoles}">
                                                        <span class="day">Miércoles</span>
                                                        <span
                                                            class="time">{{formatHorario(servicio.horario_miercoles)}}</span>
                                                    </div>
                                                    <div class="horario-row"
                                                        [ngClass]="{'active': !!servicio.horario_jueves}">
                                                        <span class="day">Jueves</span>
                                                        <span
                                                            class="time">{{formatHorario(servicio.horario_jueves)}}</span>
                                                    </div>
                                                    <div class="horario-row"
                                                        [ngClass]="{'active': !!servicio.horario_viernes}">
                                                        <span class="day">Viernes</span>
                                                        <span
                                                            class="time">{{formatHorario(servicio.horario_viernes)}}</span>
                                                    </div>
                                                    <div class="horario-row"
                                                        [ngClass]="{'active': !!servicio.horario_sabado}">
                                                        <span class="day">Sábado</span>
                                                        <span
                                                            class="time">{{formatHorario(servicio.horario_sabado)}}</span>
                                                    </div>
                                                    <div class="horario-row"
                                                        [ngClass]="{'active': !!servicio.horario_domingo}">
                                                        <span class="day">Domingo</span>
                                                        <span
                                                            class="time">{{formatHorario(servicio.horario_domingo)}}</span>
                                                    </div>
                                                </div>
                                            </mat-menu>
                                        </td>
                                    </ng-container>

                                    <tr mat-header-row *matHeaderRowDef="serviceDisplayColumns"></tr>
                                    <tr mat-row *matRowDef="let row; columns: serviceDisplayColumns;"></tr>

                                    <!-- Row shown when there is no matching data. -->
                                    <tr class="mat-row" *matNoDataRow>
                                        <td class="mat-cell text-center py-4"
                                            [attr.colspan]="serviceDisplayColumns.length">
                                            <div class="no-data-message">
                                                <mat-icon>search_off</mat-icon>
                                                <p>No se encontraron servicios que coincidan con el filtro.
                                                </p>
                                            </div>
                                        </td>
                                    </tr>
                                </table>

                                <mat-paginator #serviciosPaginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons>
                                </mat-paginator>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>
            
            <!-- Nueva pestaña: Capacidad Instalada -->
            <mat-tab label="Capacidad Instalada">
                <div class="capacidad-container p-15">
                    <div class="alert alert-bg-warning d-flex align-items-center" role="alert"
                        *ngIf="!visitData?.prestador?.fiscalYearCapacidades || visitData?.prestador?.fiscalYearCapacidades.length === 0">
                        <i class="material-icons align-middle mr-2">warning</i>
                        No hay información de capacidad instalada disponible para este prestador.
                    </div>

                    <div *ngIf="visitData?.prestador?.fiscalYearCapacidades && visitData?.prestador?.fiscalYearCapacidades.length > 0">
                        <div class="capacidad-data">
                            <!-- Recursos de Internación -->
                            <div class="capacidad-section">
                                <h4 class="section-title">Recursos de Internación</h4>
                                <div class="capacidad-grid">
                                    <div class="capacidad-card" *ngIf="visitData.prestador.fiscalYearCapacidades[0]?.camas_concepto">
                                        <div class="capacidad-header">
                                            <mat-icon class="capacidad-icon">single_bed</mat-icon>
                                            <h5>Camas</h5>
                                        </div>
                                        <div class="capacidad-info">
                                            <div class="info-item">
                                                <span class="info-label">Concepto:</span>
                                                <span class="info-value">{{visitData.prestador.fiscalYearCapacidades[0]?.camas_concepto}}</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Cantidad:</span>
                                                <span class="info-value quantity">{{visitData.prestador.fiscalYearCapacidades[0]?.camas_cantidad}}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="capacidad-card" *ngIf="visitData.prestador.fiscalYearCapacidades[0]?.camillas_concepto">
                                        <div class="capacidad-header">
                                            <mat-icon class="capacidad-icon">airline_seat_flat</mat-icon>
                                            <h5>Camillas</h5>
                                        </div>
                                        <div class="capacidad-info">
                                            <div class="info-item">
                                                <span class="info-label">Concepto:</span>
                                                <span class="info-value">{{visitData.prestador.fiscalYearCapacidades[0]?.camillas_concepto}}</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Cantidad:</span>
                                                <span class="info-value quantity">{{visitData.prestador.fiscalYearCapacidades[0]?.camillas_cantidad}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Infraestructura -->
                            <div class="capacidad-section">
                                <h4 class="section-title">Infraestructura</h4>
                                <div class="capacidad-grid">
                                    <div class="capacidad-card" *ngIf="visitData.prestador.fiscalYearCapacidades[0]?.salas_concepto">
                                        <div class="capacidad-header">
                                            <mat-icon class="capacidad-icon">meeting_room</mat-icon>
                                            <h5>Salas</h5>
                                        </div>
                                        <div class="capacidad-info">
                                            <div class="info-item">
                                                <span class="info-label">Concepto:</span>
                                                <span class="info-value">{{visitData.prestador.fiscalYearCapacidades[0]?.salas_concepto}}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="capacidad-card" *ngIf="visitData.prestador.fiscalYearCapacidades[0]?.sillas_concepto">
                                        <div class="capacidad-header">
                                            <mat-icon class="capacidad-icon">chair</mat-icon>
                                            <h5>Sillas</h5>
                                        </div>
                                        <div class="capacidad-info">
                                            <div class="info-item">
                                                <span class="info-label">Concepto:</span>
                                                <span class="info-value">{{visitData.prestador.fiscalYearCapacidades[0]?.sillas_concepto}}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="capacidad-card" *ngIf="visitData.prestador.fiscalYearCapacidades[0]?.consultorios_concepto">
                                        <div class="capacidad-header">
                                            <mat-icon class="capacidad-icon">medical_services</mat-icon>
                                            <h5>Consultorios</h5>
                                        </div>
                                        <div class="capacidad-info">
                                            <div class="info-item">
                                                <span class="info-label">Concepto:</span>
                                                <span class="info-value">{{visitData.prestador.fiscalYearCapacidades[0]?.consultorios_concepto}}</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Cantidad:</span>
                                                <span class="info-value quantity">{{visitData.prestador.fiscalYearCapacidades[0]?.consultorios_cantidad}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Transporte Sanitario -->
                            <div class="capacidad-section">
                                <h4 class="section-title">Transporte Sanitario</h4>
                                <div class="capacidad-grid">
                                    <div class="capacidad-card" *ngIf="visitData.prestador.fiscalYearCapacidades[0]?.unidad_movil_concepto">
                                        <div class="capacidad-header">
                                            <mat-icon class="capacidad-icon">local_shipping</mat-icon>
                                            <h5>Unidad Móvil</h5>
                                        </div>
                                        <div class="capacidad-info">
                                            <div class="info-item">
                                                <span class="info-label">Concepto:</span>
                                                <span class="info-value">{{visitData.prestador.fiscalYearCapacidades[0]?.unidad_movil_concepto}}</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Cantidad:</span>
                                                <span class="info-value quantity">{{visitData.prestador.fiscalYearCapacidades[0]?.unidad_movil_cantidad}}</span>
                                            </div>
                                            <div class="info-item" *ngIf="visitData.prestador.fiscalYearCapacidades[0]?.unidad_movil_placa">
                                                <span class="info-label">Placa:</span>
                                                <span class="info-value placa">{{visitData.prestador.fiscalYearCapacidades[0]?.unidad_movil_placa}}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="capacidad-card" *ngIf="visitData.prestador.fiscalYearCapacidades[0]?.ambulancias_concepto">
                                        <div class="capacidad-header">
                                            <mat-icon class="capacidad-icon">emergency</mat-icon>
                                            <h5>Ambulancias</h5>
                                        </div>
                                        <div class="capacidad-info">
                                            <div class="info-item">
                                                <span class="info-label">Concepto:</span>
                                                <span class="info-value">{{visitData.prestador.fiscalYearCapacidades[0]?.ambulancias_concepto}}</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Cantidad:</span>
                                                <span class="info-value quantity">{{visitData.prestador.fiscalYearCapacidades[0]?.ambulancias_cantidad}}</span>
                                            </div>
                                            <div class="info-item" *ngIf="visitData.prestador.fiscalYearCapacidades[0]?.ambulancias_placa">
                                                <span class="info-label">Placa:</span>
                                                <span class="info-value placa">{{visitData.prestador.fiscalYearCapacidades[0]?.ambulancias_placa}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>
        </mat-tab-group>
    </mat-card-content>
</mat-card>

<!-- Servicios de la Visita -->
<mat-card class="trinta-card mb-25 bg-white border-none d-block"
    *ngIf="visitData?.visitServicios && visitData?.visitServicios.length > 0">
    <mat-card-header>
        <mat-card-title>
            <h4 class="mt-0 mb-0">
                Servicios seleccionados a evaluar
            </h4>
        </mat-card-title>
    </mat-card-header>
    <mat-card-content>
        <div class="row">
            <div class="col-md-12">
                <mat-chip-set>
                    <div class="selected-chips-container">
                        <mat-chip *ngFor="let servicio of visitData?.visitServicios"
                            [matTooltip]="servicio.servicio_id.code">
                            {{servicio.servicio_id.name}}
                        </mat-chip>
                    </div>
                </mat-chip-set>
            </div>
        </div>
    </mat-card-content>
</mat-card>

<!-- Componentes del Acta -->
<mat-card class="trinta-card mb-25 bg-white border-none d-block">
    <mat-card-header>
        <mat-card-title>
            <h4 class="mt-0 mb-0">
                Componentes del Acta
            </h4>
        </mat-card-title>
    </mat-card-header>
    <mat-card-content>
        <mat-tab-group class="tabContainerNotAfected">
            <mat-tab label="Talento Humano">
                <div class="p-15">
                    <h5>Verificadores Asignados</h5>
                    <div class="d-flex align-items-center flex-wrap mb-15">
                        <div *ngFor="let verificadorId of visitData?.th_verificadores; let i = index">
                            <div *ngFor="let member of visitData?.visitVerificadores">
                                <div *ngIf="member.user_id.id === verificadorId"
                                    [matTooltip]="member.user_id.name + ' ' + (member.user_id.surname || '') + ' ' + (member.user_id.lastname || '')"
                                    class="mr-5 bg{{i}} avatarElement rounded-circle justify-content-center align-items-center d-flex fw-semibold text-center w-50 h-50">
                                    {{(member.user_id.name || '')[0]}}{{((member.user_id.lastname ||
                                    member.user_id.surname) || '')[0]}}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="findings-container">
                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>person_search</mat-icon>
                                <h6>Hallazgos Todos</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.th_todos || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>

                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>person</mat-icon>
                                <h6>Hallazgos Propios</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.th_propios || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>

            <mat-tab label="Infraestructura">
                <div class="p-15">
                    <h5>Verificadores Asignados</h5>
                    <div class="d-flex align-items-center flex-wrap mb-15"
                        *ngIf="visitData?.infra_verificadores">
                        <div *ngFor="let verificadorId of visitData?.infra_verificadores; let i = index">
                            <div *ngFor="let member of visitData?.visitVerificadores">
                                <div *ngIf="member.user_id.id === verificadorId"
                                    [matTooltip]="member.user_id.name + ' ' + (member.user_id.surname || '') + ' ' + (member.user_id.lastname || '')"
                                    class="mr-5 bg{{i}} avatarElement rounded-circle justify-content-center align-items-center d-flex fw-semibold text-center w-50 h-50">
                                    {{(member.user_id.name || '')[0]}}{{((member.user_id.lastname ||
                                    member.user_id.surname) || '')[0]}}
                                </div>
                            </div>
                        </div>
                    </div>
                    <p *ngIf="!visitData?.infra_verificadores">No hay verificadores asignados</p>

                    <div class="findings-container">
                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>domain</mat-icon>
                                <h6>Hallazgos Todos</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.infra_todos || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>

                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>apartment</mat-icon>
                                <h6>Hallazgos Propios</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.infra_propios || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>

            <mat-tab label="Dotación">
                <div class="p-15">
                    <h5>Verificadores Asignados</h5>
                    <div class="d-flex align-items-center flex-wrap mb-15"
                        *ngIf="visitData?.dotacion_verificadores">
                        <div *ngFor="let verificadorId of visitData?.dotacion_verificadores; let i = index">
                            <div *ngFor="let member of visitData?.visitVerificadores">
                                <div *ngIf="member.user_id.id === verificadorId"
                                    [matTooltip]="member.user_id.name + ' ' + (member.user_id.surname || '') + ' ' + (member.user_id.lastname || '')"
                                    class="mr-5 bg{{i}} avatarElement rounded-circle justify-content-center align-items-center d-flex fw-semibold text-center w-50 h-50">
                                    {{(member.user_id.name || '')[0]}}{{((member.user_id.lastname ||
                                    member.user_id.surname) || '')[0]}}
                                </div>
                            </div>
                        </div>
                    </div>
                    <p *ngIf="!visitData?.dotacion_verificadores">No hay verificadores asignados</p>

                    <div class="findings-container">
                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>inventory_2</mat-icon>
                                <h6>Hallazgos Todos</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.dotacion_todos || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>

                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>inventory</mat-icon>
                                <h6>Hallazgos Propios</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.dotacion_propios || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>

            <mat-tab label="Medicamentos, Dispositivos e Insumos">
                <div class="p-15">
                    <h5>Verificadores Asignados</h5>
                    <div class="d-flex align-items-center flex-wrap mb-15"
                        *ngIf="visitData?.mdi_verificadores">
                        <div *ngFor="let verificadorId of visitData?.mdi_verificadores; let i = index">
                            <div *ngFor="let member of visitData?.visitVerificadores">
                                <div *ngIf="member.user_id.id === verificadorId"
                                    [matTooltip]="member.user_id.name + ' ' + (member.user_id.surname || '') + ' ' + (member.user_id.lastname || '')"
                                    class="mr-5 bg{{i}} avatarElement rounded-circle justify-content-center align-items-center d-flex fw-semibold text-center w-50 h-50">
                                    {{(member.user_id.name || '')[0]}}{{((member.user_id.lastname ||
                                    member.user_id.surname) || '')[0]}}
                                </div>
                            </div>
                        </div>
                    </div>
                    <p *ngIf="!visitData?.mdi_verificadores">No hay verificadores asignados</p>

                    <div class="findings-container">
                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>medication</mat-icon>
                                <h6>Hallazgos Todos</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.mdi_todos || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>

                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>medical_services</mat-icon>
                                <h6>Hallazgos Propios</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.mdi_propios || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>

            <mat-tab label="Procedimientos">
                <div class="p-15">
                    <h5>Verificadores Asignados</h5>
                    <div class="d-flex align-items-center flex-wrap mb-15"
                        *ngIf="visitData?.procedimientos_verificadores">
                        <div
                            *ngFor="let verificadorId of visitData?.procedimientos_verificadores; let i = index">
                            <div *ngFor="let member of visitData?.visitVerificadores">
                                <div *ngIf="member.user_id.id === verificadorId"
                                    [matTooltip]="member.user_id.name + ' ' + (member.user_id.surname || '') + ' ' + (member.user_id.lastname || '')"
                                    class="mr-5 bg{{i}} avatarElement rounded-circle justify-content-center align-items-center d-flex fw-semibold text-center w-50 h-50">
                                    {{(member.user_id.name || '')[0]}}{{((member.user_id.lastname ||
                                    member.user_id.surname) || '')[0]}}
                                </div>
                            </div>
                        </div>
                    </div>
                    <p *ngIf="!visitData?.procedimientos_verificadores">No hay verificadores asignados</p>

                    <div class="findings-container">
                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>healing</mat-icon>
                                <h6>Hallazgos Todos</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.procedimientos_todos || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>

                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>local_hospital</mat-icon>
                                <h6>Hallazgos Propios</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.procedimientos_propios || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>

            <mat-tab label="Historia Clínica y Registros">
                <div class="p-15">
                    <h5>Verificadores Asignados</h5>
                    <div class="d-flex align-items-center flex-wrap mb-15"
                        *ngIf="visitData?.hcr_verificadores">
                        <div *ngFor="let verificadorId of visitData?.hcr_verificadores; let i = index">
                            <div *ngFor="let member of visitData?.visitVerificadores">
                                <div *ngIf="member.user_id.id === verificadorId"
                                    [matTooltip]="member.user_id.name + ' ' + (member.user_id.surname || '') + ' ' + (member.user_id.lastname || '')"
                                    class="mr-5 bg{{i}} avatarElement rounded-circle justify-content-center align-items-center d-flex fw-semibold text-center w-50 h-50">
                                    {{(member.user_id.name || '')[0]}}{{((member.user_id.lastname ||
                                    member.user_id.surname) || '')[0]}}
                                </div>
                            </div>
                        </div>
                    </div>
                    <p *ngIf="!visitData?.hcr_verificadores">No hay verificadores asignados</p>

                    <div class="findings-container">
                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>description</mat-icon>
                                <h6>Hallazgos Todos</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.hcr_todos || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>

                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>article</mat-icon>
                                <h6>Hallazgos Propios</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.hcr_propios || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>

            <mat-tab label="Interdependencias">
                <div class="p-15">
                    <h5>Verificadores Asignados</h5>
                    <div class="d-flex align-items-center flex-wrap mb-15"
                        *ngIf="visitData?.interdependencias_verificadores">
                        <div
                            *ngFor="let verificadorId of visitData?.interdependencias_verificadores; let i = index">
                            <div *ngFor="let member of visitData?.visitVerificadores">
                                <div *ngIf="member.user_id.id === verificadorId"
                                    [matTooltip]="member.user_id.name + ' ' + (member.user_id.surname || '') + ' ' + (member.user_id.lastname || '')"
                                    class="mr-5 bg{{i}} avatarElement rounded-circle justify-content-center align-items-center d-flex fw-semibold text-center w-50 h-50">
                                    {{(member.user_id.name || '')[0]}}{{((member.user_id.lastname ||
                                    member.user_id.surname) || '')[0]}}
                                </div>
                            </div>
                        </div>
                    </div>
                    <p *ngIf="!visitData?.interdependencias_verificadores">No hay verificadores asignados
                    </p>

                    <div class="findings-container">
                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>hub</mat-icon>
                                <h6>Hallazgos Todos</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.interdependencias_todos || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>

                        <div class="findings-card">
                            <div class="findings-header">
                                <mat-icon>device_hub</mat-icon>
                                <h6>Hallazgos Propios</h6>
                            </div>
                            <div class="findings-content">
                                <p>{{visitData?.interdependencias_propios || 'No hay hallazgos registrados'}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>
        </mat-tab-group>
    </mat-card-content>
</mat-card>